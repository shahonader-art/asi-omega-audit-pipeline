# Data Models

All artifacts produced by the ASI-Omega Audit Pipeline.

## 1. manifest.csv

The file inventory with cryptographic hashes.

| Column | Type | Description |
|--------|------|-------------|
| `Path` | string | Absolute file path on the generating machine |
| `Rel` | string | Relative path from repo root (forward-slash normalized) |
| `SHA256` | string | SHA-256 hex digest (64 characters, uppercase) |
| `Size` | integer | File size in bytes |

**Properties:**
- Encoding: UTF-8 with BOM (PowerShell default)
- Quoting: RFC 4180 CSV (all fields quoted)
- Ordering: sorted by `Rel` (forward-slash normalized) for determinism
- Generated by: `src/run_demo.ps1`

**Example:**
```csv
"Path","Rel","SHA256","Size"
"/repo/sample/data_sample.txt","sample/data_sample.txt","A1B2C3...","1024"
```

## 2. merkle_root.txt

The Merkle tree root hash.

| Field | Value |
|-------|-------|
| Format | 64-character lowercase hex string |
| Encoding | ASCII |
| Algorithm | SHA-256 with RFC 6962 domain separation |
| Newline | Single trailing newline |

**Example:**
```
3a7bd3e2360a3d29eea436fcfb7e44c735d117c42d1c1835420b6b9942dd4f1b
```

**Construction:**
1. Each manifest SHA-256 hash becomes a leaf: `SHA-256(0x00 || hash_hex)`
2. Pairs combined as: `SHA-256(0x01 || left || right)`
3. Odd levels: last node duplicated
4. Process repeats until single root remains

## 3. DoD.json (Declaration of Done)

Pipeline metadata and integrity proof. See `docs/schemas/dod-v2.schema.json` for the formal JSON Schema.

| Field | Type | Description |
|-------|------|-------------|
| `schema_version` | int | Always `2` for current format |
| `name` | string | Pipeline identifier |
| `generated` | string | ISO 8601 timestamp |
| `timezone` | string | IANA timezone ID |
| `culture` | string | Locale code (e.g. `nb-NO`) |
| `platform` | string | Runtime description |
| `merkle_root` | string\|null | 64-char lowercase hex, or null |
| `merkle_algorithm` | string | Algorithm description |
| `ntp_drift_seconds` | number\|null | Clock drift; `9999` = failed |
| `artefacts` | object | Presence flags for artifacts |
| `artefacts.manifest_csv` | bool | manifest.csv existed |
| `artefacts.golden_hashes` | bool | golden-hashes.json existed |
| `script_hashes` | object | Pipeline script SHA-256 hashes |

**Example:**
```json
{
  "schema_version": 2,
  "name": "asi-omega-audit-pipeline",
  "generated": "2026-02-06T12:00:00.000+01:00",
  "timezone": "Europe/Oslo",
  "culture": "nb-NO",
  "platform": "PowerShell 7+",
  "merkle_root": "3a7bd3e2...",
  "merkle_algorithm": "SHA-256 with RFC 6962 domain separation",
  "ntp_drift_seconds": 0.042,
  "artefacts": {
    "manifest_csv": true,
    "golden_hashes": true
  },
  "script_hashes": {
    "src/run_demo.ps1": "abc123...",
    "tools/Merkle.ps1": "def456..."
  }
}
```

## 4. golden-hashes.json

Known-good hash values for regression testing.

```json
{
  "files": {
    "sample/data_sample.txt": "abc123...",
    "sample/readme_sample.txt": "def456..."
  }
}
```

## 5. GPG Signatures (.asc files)

Detached ASCII-armored GPG signatures (RFC 4880).

| File | Signs |
|------|-------|
| `manifest.csv.asc` | `manifest.csv` |
| `merkle_root.txt.asc` | `merkle_root.txt` |
| `DoD/DoD.json.asc` | `DoD/DoD.json` |

**Verification:** `gpg --verify <file>.asc <file>`

## 6. OpenTimestamps Proof (.ots)

Binary OTS proof file anchored to a blockchain calendar server.

| File | Description |
|------|-------------|
| `merkle_root.txt.ots` | Binary OTS proof |
| `ots_receipt.txt` | Human-readable receipt |

**Verification:**
```bash
pip install opentimestamps-client
ots upgrade merkle_root.txt.ots   # Wait 4-24h after creation
ots verify merkle_root.txt.ots
```

## 7. TopLevelHashes.csv

SHA-256 hashes of all top-level repo files. Informational only.

| Column | Type | Description |
|--------|------|-------------|
| Name | string | Filename |
| Size | integer | File size in bytes |
| Hash | string | SHA-256 hex digest |

## 8. ledger.jsonl

Append-only audit log in JSON Lines format.

## Cryptographic Chain

```
Files on disk
    │ SHA-256 (FIPS 180-4)
    ▼
manifest.csv ─── SHA-256 ──▶ manifest.csv.asc (GPG)
    │
    │ RFC 6962 Merkle Tree
    ▼
merkle_root.txt ─── SHA-256 ──▶ merkle_root.txt.asc (GPG)
    │                      └──▶ merkle_root.txt.ots (OTS)
    ▼
DoD.json ─── SHA-256 ──▶ DoD.json.asc (GPG)
    │
    └── script_hashes{} ──▶ Self-integrity verification
```

Any modification to a source file changes its SHA-256, which changes the manifest, which changes the Merkle root, which invalidates the GPG signature and OTS proof.
